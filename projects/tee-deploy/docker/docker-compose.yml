# OpenClaw TEE Deployment â€” Docker Compose
#
# Usage:
#   1. Build: docker build -t openclaw-tee .
#   2. Generate configs: node ../src/deploy.js --dry-run (gives you the base64 values)
#   3. Set env vars below
#   4. Run: docker compose up -d
#
# Or with Podman:
#   podman build -t openclaw-tee .
#   podman-compose up -d

version: "3.8"

services:
  openclaw:
    build: .
    # Or use pre-built image:
    # image: ghcr.io/mcclowin/openclaw-tee:latest
    environment:
      - OPENCLAW_HOME=/app/.openclaw
      - NODE_ENV=production
      # Base64-encoded openclaw.json (generated by our deploy tool)
      - OPENCLAW_CONFIG_B64=${OPENCLAW_CONFIG_B64}
      # Base64-encoded auth-profiles.json (contains API key)
      - OPENCLAW_AUTH_B64=${OPENCLAW_AUTH_B64}
    ports:
      - "18789:18789"
    volumes:
      - openclaw-data:/app/.openclaw
    restart: unless-stopped
    # Security: drop all capabilities, read-only root
    security_opt:
      - no-new-privileges:true
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 2G

volumes:
  openclaw-data:
